# Open Stuff Item In New Tab

| **Document Version** | **V1.0** |
| :--- | :--- |
| **Feature Name** | - |
| **Created Date** | January 24, 2026 |
| **Status** | unimplemented |

## 1. Background

The `https://gemini.google.com/mystuff` page displays history resources (documents, images) generated by the user.
Users can see a grid layout of resource items on this page. Clicking an item redirects them to the corresponding chat history page (`/app/cid#rid`).

User Pain Points: Workflow Interruption
1. Clicking an item only allows redirection in the current page (as implemented by the frontend). After redirecting, using the browser's "Back" button to return to the "stuff" page does not automatically restore the previous scroll position.
2. Opening items in a new tab is not supported.

## 2. Goal
Implement a high-quality "Open in New Tab" extension feature to ensure a natural and smooth workflow for users.

## 3. Solution

Support "Open in New Tab" for Stuff items, providing users with an additional navigation option.

### 3.1 Add XHR Interceptor Singleton

Add an XHR interceptor singleton in `src/utils` that supports matching and listening to specific request URLs.

### 3.2 Intercept "stuff" Page XHR Requests to Retrieve Media Items

- Create a `main-world` directory in `src/entrypoints`, add a `stuff` module to implement interception logic, and export it to `url-monitor-main-world.ts` for initialization.

- Use the XHR interceptor singleton to listen for requests under the "/stuff" path.
Target URL: `/_/BardChatUi/data/batchexecute?rpcids=jGArJ&source-path=%2Fmystuff` (other parameters allowed).

- Upon matching data, parse the response and issue a notification.
  - Use `src/utils/stuffMediaParser.ts` to parse the resource response.
  - Refer to `url-monitor-main-world.ts` for event notification handling.
  - The event data object should be the processed `dataList`.

### 3.3 Data Caching and Page Modification

Add a `stuff-page` module in `src/content` to implement data caching and page modification logic, and export it to `src/entrypoints/content/index.tsx` for initialization.

1. Media Data Cache
- Listen for data response events.
- Store the returned `itemList` in memory; **no persistence required**.
Note: Perform de-duplication when storing responses, using `conversationId + responseId` as a unique identifier.

2. Add Navigation Entry to "stuff" Page Items
Refer to `.original/stuff.html` for page structure.
In the Media section of the "stuff" page, add a "NewTab" button to the top-right corner of each `library-item-card` component.

NewTab Button:
1. Structure: `div > svg`
2. Dimensions: `div` 35x35, `svg` 16x16
3. `div` Base Styles:
``` css
position: absolute;
right: 4px;
top: 4px;
width: 35px;
aspect-ratio: 1;
background:rgba(0, 0, 0, 0.4);  // hover: rgba(0, 0, 0, 0.6)
border-radius: 100%;
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
color: white
```
4. SVG:
``` html
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
  <g class="open-in-new-tab-outline">
    <g fill="currentColor" fill-rule="evenodd" class="Vector" clip-rule="evenodd">
      <path d="M5 4a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-5.263a1 1 0 1 1 2 0V19a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3h5.017a1 1 0 1 1 0 2z"></path>
      <path d="M21.411 2.572a.963.963 0 0 1 0 1.36l-8.772 8.786a.96.96 0 0 1-1.358 0a.963.963 0 0 1 0-1.36l8.773-8.786a.96.96 0 0 1 1.357 0"></path>
      <path d="M21.04 2c.53 0 .96.43.96.962V8c0 .531-.47 1-1 1s-1-.469-1-1V4h-4c-.53 0-1-.469-1-1s.43-1 .96-1z"></path>
    </g>
  </g>
</svg>
```
5. Button Interaction:
- Show the "NewTab" button when hovering over a `library-item-card`.
- Show "Open In New Tab" using Tippy when hovering over the "NewTab" button (i18n required).

### 3.4 New Tab Navigation
**Core Logic**
1. When the "NewTab" button is clicked, retrieve the `jslog` attribute from its parent `library-item-card` and extract the key ID (likely a timestamp). Example:
``` html
<library-item-card
  jslog="279444;track:generic_click,impression;BardVeMetadataKey:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[1,[1753892482,343000000]]]"
>
</library-item-card>
```
Extract `[1753892482,343000000]` from the above.

2. Original Data Lookup
Use the extracted `[1753892482,343000000]` to find the corresponding information in the cache.
Matching Logic: Find the `MediaItem` with a `timestamp` of 1753892482.

3. Open in New Tab
- Construct the navigation path: `/app/${MediaItem.conversationId}#${MediaItem.responseId}`
- Use browser APIs to open the path in a new tab (ensure it's not blocked by the page and requires no new permissions).

## 4. Others

1. Research documentation for response format and parsing: `.original/api_response`
2. Comments must be in English.
3. Code quality must be production-level.
